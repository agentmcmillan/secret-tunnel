name: ZeroTeir
options:
  bundleIdPrefix: com.zeroteir
  deploymentTarget:
    macOS: "14.0"
  createIntermediateGroups: true

packages:
  WireGuardKit:
    url: https://github.com/WireGuard/wireguard-apple
    revision: 2fec12a6e1f6e3460b6ee483aa00ad29cddadab1

targets:
  ZeroTeir:
    type: application
    platform: macOS
    deploymentTarget: "14.0"
    sources:
      - path: Sources/ZeroTeir
    resources:
      - Resources/Assets.xcassets
    info:
      path: Resources/Info.plist
      properties:
        LSUIElement: true
        CFBundleIdentifier: com.zeroteir.vpn
        CFBundleShortVersionString: "1.0"
        CFBundleVersion: "1"
    entitlements:
      path: Resources/ZeroTeir.entitlements
      properties:
        com.apple.security.app-sandbox: false
        com.apple.security.network.client: true
        com.apple.security.network.server: true
        com.apple.developer.networking.networkextension:
          - packet-tunnel-provider
        com.apple.security.application-groups:
          - group.com.zeroteir.vpn
        keychain-access-groups:
          - $(AppIdentifierPrefix)com.zeroteir.vpn
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.zeroteir.vpn
      MARKETING_VERSION: "1.0"
      CURRENT_PROJECT_VERSION: "1"
      ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon
      INFOPLIST_KEY_LSUIElement: true
      ENABLE_HARDENED_RUNTIME: true
      CODE_SIGN_STYLE: Automatic
      DEVELOPMENT_TEAM: ""
    dependencies:
      - target: ZeroTeirTunnel
        embed: true
      - framework: NetworkExtension.framework
        sdk: macOS

  ZeroTeirTunnel:
    type: app-extension
    platform: macOS
    deploymentTarget: "14.0"
    sources:
      - path: ZeroTeirTunnel
      - path: Shared
    info:
      path: ZeroTeirTunnel/Info.plist
      properties:
        CFBundleIdentifier: com.zeroteir.vpn.tunnel
        CFBundleShortVersionString: "1.0"
        CFBundleVersion: "1"
        NSExtension:
          NSExtensionPointIdentifier: com.apple.networkextension.packet-tunnel
          NSExtensionPrincipalClass: $(PRODUCT_MODULE_NAME).PacketTunnelProvider
    entitlements:
      path: ZeroTeirTunnel/ZeroTeirTunnel.entitlements
      properties:
        com.apple.developer.networking.networkextension:
          - packet-tunnel-provider
        com.apple.security.application-groups:
          - group.com.zeroteir.vpn
        com.apple.security.network.client: true
        com.apple.security.network.server: true
        com.apple.security.app-sandbox: false
        keychain-access-groups:
          - $(AppIdentifierPrefix)com.zeroteir.vpn
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.zeroteir.vpn.tunnel
      MARKETING_VERSION: "1.0"
      CURRENT_PROJECT_VERSION: "1"
      ENABLE_HARDENED_RUNTIME: true
      CODE_SIGN_STYLE: Automatic
      DEVELOPMENT_TEAM: ""
    dependencies:
      - package: WireGuardKit
      - framework: NetworkExtension.framework
        sdk: macOS
